<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Ekotify - Spotify Web Player</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter&display=swap" rel="stylesheet">
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: 'Inter', sans-serif;
      background-color: #121212;
      color: white;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
      padding: 2rem;
    }
    h1 {
      margin-bottom: 2rem;
      color: #1DB954;
    }
    button {
      padding: 1rem 2rem;
      margin: 1rem;
      background-color: #1DB954;
      border: none;
      color: white;
      font-size: 1rem;
      cursor: pointer;
      border-radius: 8px;
      transition: 0.3s ease;
    }
    button:hover {
      background-color: #1ed760;
    }
    #player-status {
      margin-top: 2rem;
    }
    @media(max-width: 600px) {
      h1 { font-size: 1.5rem; }
      button { width: 100%; }
    }
  </style>
</head>
<body>
  <h1>Ekotify</h1>
  <button id="login">Spotify ile GiriÅŸ Yap</button>
  <button id="play" style="display:none;">ÅžarkÄ±yÄ± Ã‡al</button>
  <div id="player-status"></div>

  <script src="https://sdk.scdn.co/spotify-player.js"></script>
  <script>
    const clientId = "affef24324e44ba58d0c7bac3bcd4423"; // ðŸ”´ Spotify client ID'ni buraya yaz
    const redirectUri = "https://efkantuncc.github.io/ekotify/"; // ðŸ”´ Redirect URI'n
    const scopes = [
      "streaming",
      "user-read-email",
      "user-read-private",
      "user-modify-playback-state",
      "user-read-playback-state"
    ];

    const loginBtn = document.getElementById('login');
    const playBtn = document.getElementById('play');
    const statusDiv = document.getElementById('player-status');

    // Token alma
    const hash = window.location.hash
      .substring(1)
      .split("&")
      .reduce((initial, item) => {
        if (item) {
          const parts = item.split("=");
          initial[parts[0]] = decodeURIComponent(parts[1]);
        }
        return initial;
      }, {});
    window.location.hash = "";

    const token = hash.access_token;

    if (token) {
      loginBtn.style.display = "none";
      playBtn.style.display = "inline-block";
      statusDiv.innerText = "Spotify'a baÄŸlanÄ±ldÄ±.";

      window.onSpotifyWebPlaybackSDKReady = () => {
        const player = new Spotify.Player({
          name: 'Ekotify Web Player',
          getOAuthToken: cb => { cb(token); },
          volume: 0.5
        });

        player.addListener('ready', ({ device_id }) => {
          console.log('Device ID:', device_id);
          playBtn.addEventListener('click', () => {
            fetch(`https://api.spotify.com/v1/me/player/play?device_id=${device_id}`, {
              method: 'PUT',
              body: JSON.stringify({ uris: ['spotify:track:4cOdK2wGLETKBW3PvgPWqT'] }), // ðŸ”Š Ã–rnek: Rick Astley - Never Gonna Give You Up
              headers: {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${token}`
              }
            });
          });
        });

        player.addListener('not_ready', ({ device_id }) => {
          statusDiv.innerText = "Spotify oynatÄ±cÄ± hazÄ±r deÄŸil.";
        });

        player.connect();
      };
    }

    loginBtn.addEventListener("click", () => {
      const url = `https://accounts.spotify.com/authorize?client_id=${clientId}&redirect_uri=${encodeURIComponent(redirectUri)}&scope=${scopes.join('%20')}&response_type=token&show_dialog=true`;
      window.location = url;
    });
  </script>
</body>
</html>
